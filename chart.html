<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Enhanced 3D Options Analysis Chart with Real Data</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center mb-4"><span class="material-icons icon" style="color:#4285f4;vertical-align:middle;">show_chart</span> Enhanced 3D Chart for Options Contract Analysis</h1>
        <p class="text-center">This tool uses Finnhub API for real-time options data. Sign up for a free account at <a href="https://finnhub.io/register">finnhub.io</a> to get an API key (free tier includes options chain data with rate limits). Enter your API key below. The tool fetches live data for stock price, dividend yield, option premiums, implied volatility, etc.</p>
        <div class="row">
            <div class="col-lg-4">
                <form id="inputs" class="card">
                    <div class="row-inputs">
                        <div class="form-group" style="position:relative;">
                            <label for="api_key">API Key:</label>
                            <input type="text" class="form-control" id="api_key" placeholder="Finnhub API key">
                            <div class="description">Your API key from Finnhub.io.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="ticker">Ticker:</label>
                            <input type="text" class="form-control" id="ticker" value="AAPL" list="tickers-list">
                            <datalist id="tickers-list"></datalist>
                            <div class="description">Stock symbol (auto-complete).</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="current_date">Date:</label>
                            <input type="date" class="form-control" id="current_date" value="2025-08-24">
                            <div class="description">Analysis start date.</div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary btn-block mb-gap" style="margin-bottom:18px;" onclick="loadExpirations()">Load Expirations</button>
                    <h4 class="mt-2">First Contract</h4>
                    <div class="row-inputs">
                        <div class="form-group exp-date-picker" style="position:relative;">
                            <label for="expiration">Expiration:</label>
                            <input type="date" class="form-control" id="expiration" onchange="loadStrikes()">
                            <div class="description">Select expiration date (only valid dates are enabled).</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="type">Type:</label>
                            <select class="form-control" id="type" onchange="loadStrikes()">
                                <option value="call">Call</option>
                                <option value="put">Put</option>
                            </select>
                            <div class="description">Call or Put option.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="position">Position:</label>
                            <select class="form-control" id="position">
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                            <div class="description">Buy or Sell.</div>
                        </div>
                    </div>
                    <div class="form-group" style="position:relative;">
                        <label>Strike Price:</label>
                        <div id="strike-grid" class="strike-grid"></div>
                        <input type="hidden" id="strike" value="">
                        <div class="description">Select strike price from the grid below.</div>
                    </div>
                    <div class="row-inputs">
                        <div class="form-group" style="position:relative;">
                            <label for="K">Strike (K):</label>
                            <input type="number" class="form-control" id="K" value="100" step="0.01" readonly>
                            <div class="description">Auto-filled strike price.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="P">Premium:</label>
                            <input type="number" class="form-control" id="P" value="5" step="0.01" readonly>
                            <div class="description">Auto-filled option premium.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="sig">Volatility:</label>
                            <input type="number" class="form-control" id="sig" value="0" step="0.01">
                            <div class="description">Implied volatility.</div>
                        </div>
                    </div>
                    <div class="row-inputs">
                        <div class="form-group" style="position:relative;">
                            <label for="S0">Stock Price:</label>
                            <input type="number" class="form-control" id="S0" value="100" step="0.01" readonly>
                            <div class="description">Current stock price.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="r">Risk-Free Rate:</label>
                            <input type="number" class="form-control" id="r" value="0.05" step="0.01">
                            <div class="description">Annualized rate.</div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label for="q">Dividend Yield:</label>
                            <input type="number" class="form-control" id="q" value="0" step="0.01" readonly>
                            <div class="description">Auto-filled dividend yield.</div>
                        </div>
                    </div>
                    <div class="form-group" style="position:relative;">
                        <label for="add_second">Add Second Contract:</label>
                        <input type="checkbox" id="add_second" onchange="toggleSecondContract()">
                        <div class="description">Analyze strategies (spreads, straddles, etc.).</div>
                    </div>
                    <div id="second-contract" style="display: none;">
                        <h4>Second Contract</h4>
                        <div class="row-inputs">
                            <div class="form-group exp-date-picker" style="position:relative;">
                                <label for="expiration2">Expiration:</label>
                                <input type="date" class="form-control" id="expiration2" onchange="loadStrikes2()">
                                <div class="description">Select expiration date.</div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <label for="type2">Type:</label>
                                <select class="form-control" id="type2" onchange="loadStrikes2()">
                                    <option value="call">Call</option>
                                    <option value="put">Put</option>
                                </select>
                                <div class="description">Call or Put.</div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <label for="position2">Position:</label>
                                <select class="form-control" id="position2">
                                    <option value="long">Long</option>
                                    <option value="short">Short</option>
                                </select>
                                <div class="description">Buy or Sell.</div>
                            </div>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <label>Strike Price:</label>
                            <div id="strike-grid2" class="strike-grid"></div>
                            <input type="hidden" id="strike2" value="">
                            <div class="description">Select strike price for the second contract.</div>
                        </div>
                        <div class="row-inputs">
                            <div class="form-group" style="position:relative;">
                                <label for="K2">Strike (K2):</label>
                                <input type="number" class="form-control" id="K2" value="" step="0.01" readonly>
                                <div class="description">Auto-filled strike price.</div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <label for="P2">Premium:</label>
                                <input type="number" class="form-control" id="P2" value="" step="0.01" readonly>
                                <div class="description">Auto-filled premium.</div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <label for="sig2">Volatility:</label>
                                <input type="number" class="form-control" id="sig2" value="0" step="0.01">
                                <div class="description">Implied volatility.</div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success btn-block mt-2" onclick="plotChart()">Generate Chart</button>
                </form>
            </div>
            <div class="col-lg-8">
                <div id="info" class="mt-4 text-center card d-none"></div>
                <div id="plot" class="d-none" style="width: 100%; height: 800px; margin: auto;"></div>
                <div class="card" style="margin-top:24px; padding-bottom:24px;">
                    <div id="plot2d" class="d-none" style="width: 100%; height: 600px; margin: auto;"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- External JS modules -->
    <script type="module" src="./api.js"></script>
    <script type="module" src="./options.js"></script>
    <script type="module" src="./form.js"></script>
    <script type="module" src="./chart.js"></script>
    <script type="module" src="./main.js"></script>
</body>
</html>